require("dotenv").config();
const express = require("express");
const bodyParser = require("body-parser");

const fetch = (...args) => import("node-fetch").then(({ default: fetch }) => fetch(...args));
const app = express();

// ‚úÖ ‡πÅ‡∏õ‡∏•‡∏ä‡∏∑‡πà‡∏≠‡∏ü‡∏¥‡∏•‡∏î‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢
function translateFieldNames(dataArray) {
  const map = {
    second: "‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ",
    bodyAngleL: "‡πÅ‡∏ô‡∏ß‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ã‡πâ‡∏≤‡∏¢",
    bodyAngleR: "‡πÅ‡∏ô‡∏ß‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏Ç‡∏ß‡∏≤",
    elbowAngleL: "‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡∏ã‡πâ‡∏≤‡∏¢",
    elbowAngleR: "‡∏°‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡∏Ç‡∏ß‡∏≤",
    armSpreadL: "‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏á‡πÅ‡∏Ç‡∏ô‡∏ã‡πâ‡∏≤‡∏¢",
    armSpreadR: "‡∏£‡∏∞‡∏¢‡∏∞‡∏Å‡∏≤‡∏á‡πÅ‡∏Ç‡∏ô‡∏Ç‡∏ß‡∏≤",
    kneeAngleL: "‡∏°‡∏∏‡∏°‡πÄ‡∏Ç‡πà‡∏≤‡∏ã‡πâ‡∏≤‡∏¢",
    kneeAngleR: "‡∏°‡∏∏‡∏°‡πÄ‡∏Ç‡πà‡∏≤‡∏Ç‡∏ß‡∏≤",
    kneeSpread: "‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡πÄ‡∏Ç‡πà‡∏≤‡∏ã‡πâ‡∏≤‡∏¢‚Äì‡∏Ç‡∏ß‡∏≤",
    legSpread: "‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πâ‡∏≤‡∏ã‡πâ‡∏≤‡∏¢‚Äì‡∏Ç‡∏ß‡∏≤",
    ankleSpread: "‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏ó‡πâ‡∏≤", // ‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ
    shoulderWidth: "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÑ‡∏´‡∏•‡πà",
    neckAngleL: "‡∏°‡∏∏‡∏°‡∏Ñ‡∏≠‡∏ã‡πâ‡∏≤‡∏¢",
    neckAngleR: "‡∏°‡∏∏‡∏°‡∏Ñ‡∏≠‡∏Ç‡∏ß‡∏≤",
    shoulderElbowXDiffL: "‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏´‡∏•‡πà‚Äì‡∏®‡∏≠‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡πÅ‡∏ô‡∏ß‡∏ï‡∏£‡∏á",
    shoulderElbowXDiffR: "‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏´‡∏•‡πà‚Äì‡∏®‡∏≠‡∏Å‡∏Ç‡∏ß‡∏≤‡πÅ‡∏ô‡∏ß‡∏ï‡∏£‡∏á",
    elbowToTorsoDistL: "‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡∏ã‡πâ‡∏≤‡∏¢‡∏´‡πà‡∏≤‡∏á‡∏•‡∏≥‡∏ï‡∏±‡∏ß",
elbowToTorsoDistR: "‡∏£‡∏∞‡∏¢‡∏∞‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡∏Ç‡∏ß‡∏≤‡∏´‡πà‡∏≤‡∏á‡∏•‡∏≥‡∏ï‡∏±‡∏ß",

  };

  return dataArray.map(entry => {
    const translated = {};
    for (const key in entry) {
      translated[map[key] || key] = entry[key];
    }
    return translated;
  });
}

app.use(bodyParser.json({ limit: "2mb" }));
app.use(bodyParser.urlencoded({ extended: true, limit: "2mb" }));
app.use(express.static("public"));

app.post("/analyze", async (req, res) => {
  try {
   const { pose, angles, bmi } = req.body;
    const hasLeftRight = Object.keys(angles?.[0] || {}).some(k => k.endsWith("L") || k.endsWith("R"));
    const translatedAngles = translateFieldNames(angles);

    const prompt = `
‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏î‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û  
‡∏ä‡πà‡∏ß‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡πà‡∏≤ "${pose}" ‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á ‡∏ã‡∏∂‡πà‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡πà‡∏≤‡∏°‡∏∏‡∏°‡πÅ‡∏•‡∏∞‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÉ‡∏ô‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏ß‡πâ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡∏ã‡∏∂‡πà‡∏á‡∏£‡∏ß‡∏°‡∏ñ‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏°‡∏∏‡∏°‡∏£‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏•‡∏∞ BMI ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô

üìå BMI ‡∏Ç‡∏≠‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ: ${bmi}
${
  hasLeftRight
    ? `üìå ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏¢‡∏Å‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢ (_L) ‡πÅ‡∏•‡∏∞‡∏Ç‡∏ß‡∏≤ (_R) ‡πÄ‡∏ä‡πà‡∏ô elbowAngleL, armSpreadR ‡πÄ‡∏õ‡πá‡∏ô‡∏ï‡πâ‡∏ô`
    : ""
}

**‡∏ü‡∏¥‡∏•‡∏î‡πå‡∏ó‡∏µ‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÑ‡∏î‡πâ:**
- \`bodyAngle\`: ‡πÅ‡∏ô‡∏ß‡πÑ‡∏´‡∏•‡πà‚Äì‡∏™‡∏∞‡πÇ‡∏û‡∏Å‚Äì‡∏Ç‡πâ‡∏≠‡πÄ‡∏ó‡πâ‡∏≤ ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡∏£‡∏á‡∏Ç‡∏≠‡∏á‡∏•‡∏≥‡∏ï‡∏±‡∏ß (‡∏ó‡∏∏‡∏Å‡∏ó‡πà‡∏≤)
- \`elbowAngle\`, \`armSpread\`: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Push-Up ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≠‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏á‡πÅ‡∏Ç‡∏ô
- \`kneeAngle\`, \`legSpread\`, \`kneeSpread\`, \`shoulderWidth\`: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Squat ‡πÉ‡∏ä‡πâ‡∏ß‡∏±‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏•‡∏∂‡∏Å‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡πà‡∏≠‡πÄ‡∏Ç‡πà‡∏≤ ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏°‡∏î‡∏∏‡∏•‡∏Ç‡∏≠‡∏á‡∏Ç‡∏≤‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà
- \`ankleSpread\`: ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡πÄ‡∏ó‡πâ‡∏≤ ‡πÉ‡∏ä‡πâ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ß‡πà‡∏≤‡∏ä‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (Squat)
- \`neckAngle\`, \`shoulderElbowXDiff\`: ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Plank ‡πÉ‡∏ä‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏ô‡∏ß‡∏Ñ‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏ô‡∏ß‡πÑ‡∏´‡∏•‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà

**‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤ BMI:**
${pose === "squat" ? (
  bmi >= 27 ? "- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ BMI ‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÑ‡∏°‡πà‡∏¢‡πà‡∏≠‡∏•‡∏∂‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡πÅ‡∏£‡∏á‡∏Å‡∏î‡πÄ‡∏Ç‡πà‡∏≤\n"
  : bmi <= 18.5 ? "- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ BMI ‡∏ï‡πà‡∏≥ ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏á‡∏ï‡∏±‡∏ß‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡πÄ‡∏Ç‡πà‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏ö‡∏¥‡∏î‡πÄ‡∏Ç‡πâ‡∏≤‡∏î‡πâ‡∏≤‡∏ô‡πÉ‡∏ô\n"
  : "- BMI ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ä‡πà‡∏ß‡∏á‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏ó‡∏≥‡∏ó‡πà‡∏≤ squat ‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö\n"
) : pose === "pushup" ? (
  bmi >= 27 ? "- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ BMI ‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å knee push-up ‡∏´‡∏£‡∏∑‡∏≠ incline push-up ‡∏Å‡πà‡∏≠‡∏ô\n"
  : bmi <= 18.5 ? "- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ BMI ‡∏ï‡πà‡∏≥ ‡∏Ñ‡∏ß‡∏£‡πÄ‡∏ô‡πâ‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏°‡∏±‡πà‡∏ô‡∏Ñ‡∏á‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏•‡∏≥‡∏ï‡∏±‡∏ß\n"
  : "- BMI ‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥ push-up ‡πÑ‡∏î‡πâ\n"
) : pose === "plank" ? (
  bmi >= 27 ? "- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ BMI ‡∏™‡∏π‡∏á ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡πà‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞ core ‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏≠ ‡∏Ñ‡∏ß‡∏£‡πÉ‡∏´‡πâ‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏´‡∏£‡∏∑‡∏≠ AI ‡πÄ‡∏ä‡πá‡∏Ñ‡∏´‡∏•‡∏±‡∏á\n"
  : bmi <= 18.5 ? "- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ BMI ‡∏ï‡πà‡∏≥ ‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏≠‡πà‡∏ô‡πÄ‡∏û‡∏£‡∏≤‡∏∞ core ‡∏≠‡πà‡∏≠‡∏ô‡πÅ‡∏£‡∏á\n"
  : "- BMI ‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ plank ‡πÑ‡∏î‡πâ\n"
) : pose === "bicep" ? (
  bmi >= 27 ? "- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ BMI ‡∏™‡∏π‡∏á ‡∏Ñ‡∏ß‡∏£‡∏ô‡∏±‡πà‡∏á‡∏ó‡∏≥ Bicep Curl ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏¢‡∏Å‡∏•‡∏≥‡∏ï‡∏±‡∏ß ‡πÅ‡∏•‡∏∞‡πÉ‡∏ä‡πâ‡∏î‡∏±‡∏°‡πÄ‡∏ö‡∏•‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏û‡∏≠‡∏î‡∏µ\n"
  : bmi <= 18.5 ? "- ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏°‡∏µ BMI ‡∏ï‡πà‡∏≥ ‡∏Ñ‡∏ß‡∏£‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏Ç‡πâ‡∏≠‡∏®‡∏≠‡∏Å‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡∏ö‡∏•‡∏≥‡∏ï‡∏±‡∏ß ‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏ß‡∏µ‡πà‡∏¢‡∏á‡πÅ‡∏Ç‡∏ô\n"
  : "- BMI ‡∏õ‡∏Å‡∏ï‡∏¥ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ó‡∏≥ Bicep Curl ‡πÑ‡∏î‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏ä‡πà‡∏ß‡∏á\n"
) : ""

}


**‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á:**
${JSON.stringify(translatedAngles, null, 2)}

---

**‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á (‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡∏±‡∏ö‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡πà‡∏≤):**

- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡πà‡∏≤ **Squat**:
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`kneeAngleL/R\` ‡∏ß‡πà‡∏≤‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤‡∏á‡∏≠‡∏•‡∏∂‡∏Å‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`kneeSpread\` ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö \`shoulderWidth\` ‡∏ß‡πà‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÑ‡∏´‡∏°
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`ankleSpread\` ‡∏ß‡πà‡∏≤‡∏ä‡∏¥‡∏î‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`bodyAngle\` ‡∏ß‡πà‡∏≤‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏£‡∏∑‡∏≠‡∏´‡∏•‡∏±‡∏á
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`ankleSpread\` ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö \`shoulderWidth\` ‡∏ß‡πà‡∏≤‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÑ‡∏´‡∏°

- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡πà‡∏≤ **Push-Up**:
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`elbowAngleL/R\` ‡∏ß‡πà‡∏≤‡∏•‡∏∂‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡πÑ‡∏´‡∏°
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`armSpreadL/R\` ‡∏ß‡πà‡∏≤‡∏Å‡∏≤‡∏á‡πÅ‡∏Ç‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÑ‡∏´‡∏°
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`ankleSpread\` ‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö \`shoulderWidth\` ‡∏ß‡πà‡∏≤‡πÄ‡∏ó‡πâ‡∏≤‡∏ä‡∏¥‡∏î‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ‡πÑ‡∏´‡∏°
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`bodyAngle\` ‡∏ß‡πà‡∏≤‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏ï‡∏£‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏≠‡πà‡∏ô

- ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏ó‡πà‡∏≤ **Plank**:
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`neckAngleL/R\` ‡∏ß‡πà‡∏≤‡∏Ñ‡∏≠‡∏ï‡∏£‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏≠‡∏µ‡∏¢‡∏á
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`shoulderElbowXDiffL/R\` ‡∏ß‡πà‡∏≤‡πÑ‡∏´‡∏•‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏®‡∏≠‡∏Å‡πÑ‡∏´‡∏°
  - ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå \`bodyAngle\` ‡∏ß‡πà‡∏≤‡∏•‡∏≥‡∏ï‡∏±‡∏ß‡∏´‡∏¢‡πà‡∏≠‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏≠‡πà‡∏ô

---

**‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö:**
- ‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏ó‡πà‡∏≤ "${pose}" ‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß
- ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏õ‡∏£‡∏∞‡πÄ‡∏î‡πá‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏à‡∏≤‡∏Å field ‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á
- ‡πÉ‡∏ä‡πâ bullet point ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏ö‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏¢‡πà‡∏≠‡∏¢
- ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡πâ‡∏≠‡πà‡∏≤‡∏ô‡∏á‡πà‡∏≤‡∏¢ ‡∏™‡∏±‡πâ‡∏ô ‡∏Å‡∏£‡∏∞‡∏ä‡∏±‡∏ö 
- ‡∏õ‡∏¥‡∏î‡∏ó‡πâ‡∏≤‡∏¢‡∏î‡πâ‡∏ß‡∏¢‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥
- ‡∏´‡πâ‡∏≤‡∏°‡∏û‡∏π‡∏î‡∏ñ‡∏∂‡∏á "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏ö" ‡∏´‡∏£‡∏∑‡∏≠ "null" ‡πÅ‡∏°‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
- ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ö‡∏≠‡∏Å‡∏≠‡∏á‡∏®‡∏≤ ‡πÅ‡∏Ñ‡πà‡∏ö‡∏≠‡∏Å‡∏°‡∏≤‡πÄ‡∏•‡∏¢‡∏ß‡πà‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏Å‡∏•
- ‡∏°‡∏µ‡∏≠‡∏¥‡πÇ‡∏°‡∏à‡∏¥ ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ô‡πà‡∏≤‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô
- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°‡∏à‡∏≤‡∏Å 0‚Äì100 ‡∏ï‡∏≤‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏ü‡∏≠‡∏£‡πå‡∏° ‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏ß‡πà‡∏≤ "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏ß‡∏°: xx/100" ‡πÄ‡∏ä‡πà‡∏ô‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡∏ï‡∏±‡∏ß: ‡∏•‡∏≥‡∏ï‡∏±‡∏ß (bodyAngle): 91.67 ‡πÄ‡∏Ç‡πà‡∏≤‡∏ã‡πâ‡∏≤‡∏¢ (kneeAngleL): 88.89
- ‡∏´‡πâ‡∏≤‡∏°‡∏•‡∏∞‡πÄ‡∏ß‡πâ‡∏ô ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏£‡∏≤‡∏¢‡∏ï‡∏±‡∏ß: ‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î ‡∏°‡∏¥‡∏â‡∏∞‡∏ô‡∏±‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏∞‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡πÑ‡∏î‡πâ

**‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ:**

‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏ó‡πà‡∏≤ ${pose} ‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°:

... (‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏™‡∏£‡∏∏‡∏õ 3‚Äì5 ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î) ...

üìå ‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥: ...
`;

    console.log("üì§ ‡∏™‡πà‡∏á prompt ‡πÑ‡∏õ‡∏¢‡∏±‡∏á Gemini:\n", prompt);

    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${process.env.GEMINI_API_KEY}`,
      {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          contents: [
            {
              role: "user",
              parts: [{ text: prompt }],
            },
          ],
        }),
      }
    );

    if (!response.ok) {
      const text = await response.text();
      console.error("‚ùå Gemini API error:", text);
      return res.status(500).json({ message: `‚ùå Gemini API error ${response.status}` });
    }

    const data = await response.json();
    const message = data?.candidates?.[0]?.content?.parts?.[0]?.text;

    if (!message) {
      return res.status(500).json({ message: "‚ùå Gemini ‡πÑ‡∏°‡πà‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå" });
    }

    res.json({ message: message.trim() });
  } catch (err) {
    console.error("üî• ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î:", err);
    res.status(500).json({ message: "‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Gemini ‡∏´‡∏£‡∏∑‡∏≠‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ" });
  }
});

// ‚úÖ Server start
const PORT = process.env.PORT || 3000;
app.listen(PORT, () => {
  console.log(`‚úÖ Server ready at http://localhost:${PORT}`);
});
